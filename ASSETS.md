# Assets Documentation

## HTML Entry Points

### player.html
- **Purpose**: Main DJ mix player SPA (mixes.4st.uk)
- **Layout**: 3 columns (player, queue, browser)
- **Features**: Mix playback, queue management, search, live streams, settings
- **Responsive**: Yes (mobile, tablet, desktop)

### live.html
- **Purpose**: Standalone live streaming SPA (live.4st.uk)
- **Layout**: Single column, mobile-first
- **Features**: Live stream management, collections, drag-drop reordering
- **Independent Hosting**: Yes (can run separately from player.html)

---

## Stylesheets

### player.css
- **Purpose**: Styling for player.html
- **Size**: Main stylesheet for the DJ mix player interface

### live.css
- **Purpose**: Styling for live.html
- **Size**: Minimal stylesheet for live streaming interface
- **Design**: Mobile-first, single-column layout

---

## JavaScript Modules

### Core Modules (Shared)

#### core.js (140 lines)
- **Purpose**: Shared utilities, global state, DOM references
- **Used by**: All modules
- **Functions**: UI helpers, event handling, DOM utilities, state management

#### player.js (250+ lines)
- **Purpose**: Playback controls, waveform rendering, audio handling
- **Dependencies**: core.js
- **Used by**: player.html, live.html
- **Features**: Play/pause, volume, progress, waveform display

### Player-Specific Modules

#### mixes.js
- **Purpose**: Load mix data from `manifest.json` files
- **Used by**: player.html
- **Data Source**: DJ folder manifest files

#### queue.js
- **Purpose**: Queue management, drag-drop operations
- **Dependencies**: core.js
- **Used by**: player.html
- **Features**: Add/remove tracks, reorder, shuffle

#### player-mix.js (300 lines)
- **Purpose**: Mix-specific playback logic extracted from player.js
- **Dependencies**: core.js, player.js
- **Used by**: player.html
- **Features**: Track switching, queue integration

#### browser.js
- **Purpose**: Mix browser, search, settings, page restoration
- **Dependencies**: core.js, player.js, mixes.js, queue.js
- **Used by**: player.html
- **Features**: Mix discovery, search, browse modes, settings UI

### Live Streaming Module

#### live.js (558 lines)
- **Purpose**: Live stream management and UI
- **Dependencies**: core.js, player.js
- **Used by**: live.html
- **Features**:
  - Stream management (add, remove, reorder)
  - Drag-drop reordering
  - Collections (save/load/clear)
  - Stream probing (PLS, M3U parsing)
  - Built-in streams (SomaFM, etc.)
  - Stream editing (name, genre)
  - Persistent storage (localStorage)

---

## Data Files

### manifest.json (per DJ folder)
- **Purpose**: List of tracks, cover art, metadata for each DJ
- **Location**: `trip/`, `izmar/`, `aboo/`, `jx3p/`, `gmanual/`, `haze/`, `rpfr/`, `moreDJs/*/`
- **Format**: JSON with track metadata

### .tracks.txt (per DJ folder)
- **Purpose**: Human-readable track list with timestamps
- **Format**: CSV with `time,title,artist[,remixer]`

### .peaks.json (per DJ folder)
- **Purpose**: Waveform data for audio visualization
- **Generated by**: `generate-peaks.py`

### search-index.json
- **Purpose**: Search index for mix discovery
- **Generated by**: `generate-search-index.py`

### audio-source-config.json
- **Purpose**: Configuration for external audio sources

---

## Configuration & Metadata

### .htaccess
- **Purpose**: DirectoryIndex configuration, MP3 download forcing
- **Location**: Root directory

### AGENTS.md
- **Purpose**: Project architecture and build instructions
- **Audience**: Developers, automated systems

---

## Python Scripts

### generate-covers.py
- **Purpose**: Extract embedded cover art from audio files
- **Run**: After adding new audio files
- **Output**: Cover images in DJ folders

### generate-manifest.py
- **Purpose**: Regenerate `manifest.json` in each DJ folder
- **Run**: After adding/updating audio files
- **Output**: `manifest.json` files with track metadata

### generate-peaks.py
- **Purpose**: Generate `.peaks.json` waveform data
- **Run**: After adding audio files
- **Output**: `.peaks.json` in DJ folders

### generate-search-index.py
- **Purpose**: Regenerate `search-index.json`
- **Run**: After manifest changes
- **Output**: `search-index.json` (search index)

### extract-tracklists.py
- **Purpose**: One-time migration tool
- **Task**: Extract track lists from legacy HTML to `.tracks.txt` CSV

### fix-metadata.py
- **Purpose**: Metadata cleanup and validation
- **Run**: As needed for data corrections

---

## Architecture Diagram

### player.html Stack
```
core.js (shared utilities)
    ↓
mixes.js (mix data loading)
    ↓
queue.js (queue management)
    ↓
player.js (playback)
    ↓
player-mix.js (mix-specific logic)
    ↓
browser.js (mix browser, all modes)
    ↓
player.html (3-column SPA)
```

### live.html Stack
```
core.js (shared utilities)
    ↓
player.js (playback controls)
    ↓
live.js (stream management)
    ↓
live.html (single-column SPA)
```

---

## Directory Structure

```
/
├── player.html          # Main DJ mix player
├── player.css           # Player styling
├── live.html           # Live streaming player
├── live.css            # Live player styling
├── core.js             # Shared utilities
├── player.js           # Playback engine
├── player-mix.js       # Mix-specific playback
├── queue.js            # Queue management
├── browser.js          # Mix browser & search
├── mixes.js            # Mix data loader
├── live.js             # Live streaming
├── .htaccess           # Server configuration
├── AGENTS.md           # Architecture docs
├── ASSETS.md           # This file
├── search-index.json   # Search index
├── audio-source-config.json  # Audio config
├── generate-*.py       # Data generation scripts
├── trip/               # DJ folder (with manifest.json, .tracks.txt, cover, .peaks.json)
├── izmar/              # DJ folder
├── aboo/               # DJ folder
├── jx3p/               # DJ folder
├── gmanual/            # DJ folder
├── haze/               # DJ folder
├── rpfr/               # DJ folder
└── moreDJs/            # Additional DJ folders
    ├── [dj-name]/      # Individual DJ folders
    └── ...
```

---

## Development Workflow

1. **Add Audio Files**: Place MP3s in DJ folder (e.g., `trip/`)
2. **Generate Metadata**: Run `python3 generate-manifest.py`
3. **Extract Covers**: Run `python3 generate-covers.py`
4. **Generate Waveforms**: Run `python3 generate-peaks.py`
5. **Update Search**: Run `python3 generate-search-index.py`
6. **Test**: Load `player.html` or `live.html` in browser
7. **Deploy**: Push to git, deploy to server

---

## File Sizes & Performance

| File | Size | Purpose |
|------|------|---------|
| player.html | ~5KB | Main entry point |
| live.html | ~2KB | Live streaming entry |
| player.css | ~50KB | Player styling |
| live.css | ~30KB | Live styling |
| core.js | ~5KB | Shared utilities |
| player.js | ~30KB | Playback engine |
| player-mix.js | ~15KB | Mix logic |
| queue.js | ~20KB | Queue management |
| browser.js | ~80KB | Browser/search/settings |
| mixes.js | ~5KB | Data loader |
| live.js | ~25KB | Live streaming |
| **Total JS** | **~180KB** | Uncompressed |
| **Total** | **~270KB** | + CSS + HTML |

---

## Hosting

### mixes.4st.uk
- **Entry Point**: player.html
- **Dependencies**: All modules (core, player, mixes, queue, browser, player-mix, mixes)
- **Data**: DJ folders with manifests, cover art, waveform data

### live.4st.uk
- **Entry Point**: live.html
- **Dependencies**: core.js, player.js, live.js
- **Size**: ~70MB (minimal, live streams only)
- **Independence**: Can be hosted separately, independent from mixes.4st.uk
- **Benefits**: Load balancing, redundancy, faster deploys

---

## Notes

- All JavaScript modules use simple script loading (no bundler)
- No external npm dependencies (vanilla JavaScript)
- player.html is unchanged by live.html extraction
- Both SPAs share core.js and player.js
- live.js is fully self-contained for streaming functionality
